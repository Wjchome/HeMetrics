# Buff系统简化设计说明

## 核心设计

### 数据结构

**BuffData**（从Excel配置）：
- `UseType`: 使用类型（1=攻击力，2=防御力，7=攻速等）
- `Param1`: 值（绝对值或百分比，根据UseType决定）
- `Param2`: 待定（可用于持续时间等）

**BondData**：
- `BuffList`: `List<List<BuffData>>` - 每个等级对应一个Buff列表

### UseType映射系统

通过代码定义UseType对应的属性类型和计算方式：

```csharp
// 在BuffUseType.cs中定义
public enum BuffUseType
{
    Attack = 1,              // 攻击力（绝对值）
    Defence = 2,             // 防御力（绝对值）
    AttackPercent = 4,       // 攻击力百分比
    AttackInterval = 7,      // 攻击间隔（减少时间，单位：毫秒）
    // ...
}
```

### 工作流程

1. **配置阶段**：在Excel中配置BondData的BuffList
   ```
   等级1: [{useType:1, param1:10, param2:0}]  // 攻击力+10
   等级2: [{useType:1, param1:25, param2:0}, {useType:7, param1:-200, param2:0}]  // 攻击力+25，攻速+200ms
   ```

2. **运行时**：
   - BondManager检测羁绊激活
   - 根据羁绊等级从BondData.BuffList获取Buff列表
   - BondBuffHandler处理每个Buff：
     - 根据UseType获取属性名称
     - 判断是绝对值还是百分比
     - 计算实际加成值
     - 添加到AttributeManager

## UseType配置说明

### 绝对值类型（Param1直接是值）

| UseType | 说明 | 示例 |
|---------|------|------|
| 1 | 攻击力 | `{useType:1, param1:10}` = 攻击力+10 |
| 2 | 防御力 | `{useType:2, param1:5}` = 防御力+5 |
| 3 | 最大生命值 | `{useType:3, param1:50}` = 最大生命值+50 |
| 7 | 攻击间隔（毫秒） | `{useType:7, param1:-200}` = 攻击间隔减少200ms |
| 8 | 移动间隔（毫秒） | `{useType:8, param1:-100}` = 移动间隔减少100ms |

### 百分比类型（Param1是百分比值）

| UseType | 说明 | 示例 |
|---------|------|------|
| 4 | 攻击力百分比 | `{useType:4, param1:30}` = 攻击力+30% |
| 5 | 防御力百分比 | `{useType:5, param1:20}` = 防御力+20% |
| 6 | 最大生命值百分比 | `{useType:6, param1:50}` = 最大生命值+50% |
| 9 | 攻击间隔百分比（减少） | `{useType:9, param1:30}` = 攻击间隔减少30% |
| 10 | 移动间隔百分比（减少） | `{useType:10, param1:25}` = 移动间隔减少25% |

## 配置示例

### 示例1：简单羁绊（只有攻击力）

```json
{
  "bond": 0,
  "name": "攻击",
  "level": [2, 4, 6],
  "buffList": [
    [{useType:1, param1:10, param2:0}],                    // 等级1：攻击+10
    [{useType:1, param1:25, param2:0}],                    // 等级2：攻击+25
    [{useType:1, param1:50, param2:0}]                      // 等级3：攻击+50
  ]
}
```

### 示例2：复合羁绊（多个Buff）

```json
{
  "bond": 0,
  "name": "攻击",
  "level": [2, 4, 6],
  "buffList": [
    [{useType:1, param1:10, param2:0}],                    // 等级1：攻击+10
    [
      {useType:1, param1:25, param2:0},                    // 等级2：攻击+25
      {useType:7, param1:-200, param2:0}                    // 等级2：攻速+200ms（减少间隔）
    ],
    [
      {useType:1, param1:50, param2:0},                   // 等级3：攻击+50
      {useType:7, param1:-200, param2:0},                  // 等级3：攻速+200ms
      {useType:4, param1:30, param2:0}                    // 等级3：攻击+30%（百分比）
    ]
  ]
}
```

### 示例3：百分比羁绊

```json
{
  "bond": 1,
  "name": "防御",
  "level": [2, 4],
  "buffList": [
    [{useType:5, param1:20, param2:0}],                    // 等级1：防御+20%
    [{useType:5, param1:50, param2:0}]                      // 等级2：防御+50%
  ]
}
```

## Param2的使用（未来扩展）

Param2可以用于：
- **持续时间**：如果Param2>0，表示Buff持续N秒（需要扩展系统支持临时Buff）
- **条件参数**：用于条件Buff（如：血量低于Param2时激活）
- **其他扩展**：根据需求灵活使用

## 系统优势

1. ✅ **简单直接**：UseType通过代码映射，清晰明了
2. ✅ **配置灵活**：一个羁绊可以包含多个Buff
3. ✅ **易于扩展**：添加新的UseType只需在BuffUseType.cs中定义
4. ✅ **数值独立**：所有数值都在Excel中配置
5. ✅ **显示中间过程**：AttributeManager记录所有来源，UI可以显示

## 扩展新UseType的步骤

1. 在`BuffUseType.cs`的枚举中添加新类型
2. 在`BuffUseTypeConfig.GetAttributeName()`中添加属性名称映射
3. 在`BuffUseTypeConfig.IsPercentType()`中判断是否是百分比
4. 在`BondBuffHandler.GetBaseValue()`中添加基础值获取逻辑
5. 在Excel中配置使用新的UseType

## 注意事项

1. **UseType是代码定义的**：需要在代码中明确每个UseType的含义
2. **百分比计算**：百分比类型使用基础值计算，基础值来自角色的data
3. **时间单位**：AttackInterval和MoveInterval使用毫秒，在Character.UpdateAttributes()中转换为秒
4. **Param2暂未使用**：如果需要临时Buff或条件Buff，需要扩展系统

